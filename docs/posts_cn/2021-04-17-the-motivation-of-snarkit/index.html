<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href=https://www.fluidex.io/posts_cn/2021-04-17-the-motivation-of-snarkit/>

    <link href="/assets/main.ba97df8343d87d6470ca.css" rel="stylesheet" />

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&display=swap" rel="stylesheet">

    <title>
      WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit
      
         | Fluidex
      
    </title>

    <link rel="icon" type= “image/x-icon” href="/images/favicon.ico">

    <meta property="og:title" content="WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit">
    <meta property="og:site_name" content="Fluidex"/>
    <meta property="og:type" content="website"/>
    <meta property="og:url" content="https://www.fluidex.io/posts_cn/2021-04-17-the-motivation-of-snarkit/"/>
    <meta name="twitter:card" content="summary_large_image">

    
      <meta name="twitter:creator" content="@author_handle"/>
    

    
    
      
    
    
      <meta name="description" content="WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit 16 Apr 2021 | 1 min 现在许多项目开始喜欢使用用 WebAssembly (WASM)，因为可以在浏览器中达到像运行 native CPU 指令一样快的效率：WASM...">
      <meta property="og:description" content="WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit 16 Apr 2021 | 1 min 现在许多项目开始喜欢使用用 WebAssembly (WASM)，因为可以在浏览器中达到像运行 native CPU 指令一样快的效率：WASM...">
      <meta name="description" content="WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit 16 Apr 2021 | 1 min 现在许多项目开始喜欢使用用 WebAssembly (WASM)，因为可以在浏览器中达到像运行 native CPU 指令一样快的效率：WASM..."/>
    

    
      
    
    
      <meta property="og:image" content="https://www.fluidex.io/images/default-social-image.png"/>
      <meta name="twitter:image" content="https://www.fluidex.io/images/default-social-image.png"/>
    

  </head>
  <body>
    <div class="layout-wrapper">

      <header class="header">
        <div class="header__content">
          <h1 class="site-title">
            <a href=/>
              Fluidex
            </a>
          </h1>

          
            <nav class="nav">
              <ul class="nav__list">
                
                  
                  

                  

                  

                  <li class="nav-item">
                    <a href="/blog"  >Blog</a>
                  </li>
                
                  
                  

                  

                  

                  <li class="nav-item">
                    <a href="/about"  >About</a>
                  </li>
                
              </ul>
            </nav>

          

        </div>
      </header>

      <main class="main">
        
<article class="post">
  <header class="post__header">
    <h1>WASM 在用于 cryptogrphy 时的限制 -- 兼谈我们为什么想开发 snarkit</h1>
    <div class="post__details">
      <time datetime="2021-04-16">
        16 Apr 2021
      </time>
      <span> | </span>
      <span>1 min </span>
    </div>
  </header>

  <main class="post__content">
    
    <p>现在许多项目开始喜欢使用用 WebAssembly (WASM)，因为可以在浏览器中达到像运行 native CPU 指令一样快的效率：WASM 指令和 真正 CPU 指令之间不需要太多的 解释 (interpretation) 和转换。这对于支持多平台大有裨益。并且 WASM 支持从 C/C++/Jave/Rust/GoLang… 等语言编译过去，方便现有开发人员迁移。</p>
<p>但这只是理想的情况，事实上对于密码学相关代码来说这一切并没有那么美好：因为现代 CPU 有很多针对密码学的黑魔法/优化，如果在 WebAssembly 虚拟机里则无法利用这一点。一般来说在 WASM 里面跑 SNARK 会比在 native CPU 上慢 8 倍。</p>
<p>而且 WASM 还有各种各样的限制：</p>
<ul>
<li>不支持多线程并行。</li>
<li>能使用的内存有限制。一般来说 最多提供 1-4 G 内存供使用。否则的话你就要编译你自己版本的 WASM，像<a href="https://github.com/emscripten-core/emscripten/issues/8755#issuecomment-499682033">这样</a>。但这又会造成移植和使用上的不便。一般来说如果你在使用 <a href="https://github.com/iden3/circom/tree/master/ports/wasm">circom wasm port</a> 编译 大型电路时遇到 <code>[CompileError: WebAssembly.compile(): data segments count of 104626 exceeds internal limit of 100000</code> 的话就是这个问题导致的。</li>
</ul>
<p>上面的种种原因使我们下定决心开发并开源 <a href="https://github.com/Fluidex/snarkit">https://github.com/Fluidex/snarkit</a> 。我们在使用 <a href="https://github.com/iden3/circom/tree/master/ports/wasm">circom wasm port</a> 和 <a href="https://github.com/iden3/snarkjs">snarkjs</a> 开发大型电路时总是遇到 data segments 或者 内存不够 等类似的报错，电路开发无法继续进行。使用 <a href="https://github.com/iden3/circom/tree/master/ports/c">circom c port</a> 可以解决这样的问题。但 <a href="https://github.com/iden3/circom/tree/master/ports/c">circom c port</a> 并没有得到很好的封装，每次都需要写脚本以调用来编译电路和生成 witness，这其实对于其他没有这些脚本的开发者并不方便。（有一些问题并不是 WASM 带来的，而是 node 默认参数带来的，但使用 snarkit 正好一并解决了这些问题。）<a href="https://github.com/Fluidex/snarkit">https://github.com/Fluidex/snarkit</a> 对 <a href="https://github.com/iden3/circom/tree/master/ports/c">circom c port</a> 进行了封装，使得开发者终于可以方便地使用 <a href="https://github.com/iden3/circom">circom 语言</a> 开发大型电路，witness generation 也可以更加快。</p>
<p>这就是我们开发 <a href="https://github.com/Fluidex/snarkit">https://github.com/Fluidex/snarkit</a> 的初衷，欢迎大家使用。</p>

  </main>

  <aside class="post__aside">
    <div class="post__tags">
      
    </div>

    <nav class="post__pagination">

        <a href="/posts_cn/zkrollup-intro1/">
          <span>←</span>
          <span>ZK-Rollup 开发经验分享 Part I</span>
        </a>

      

        <a href="/posts_cn/2021-04-17-on-plonk/">
          <span>浅谈提升 PlonK</span>
          <span>→</span>
        </a>

      
    </nav>
  </aside>

</article>

      </main>

      <footer class="footer">
        <div class="footer__content">

          <ul class="hero__social-links">
            
              
                

                
                  
                

                <li>
                  <a href="https://fluid-dex.medium.com/" target="_blank" rel="noopener noreferrer" >Medium</a>
                </li>
              
                

                
                  
                

                <li>
                  <a href="https://github.com/Fluidex" target="_blank" rel="noopener noreferrer" >GitHub</a>
                </li>
              
                

                
                  
                

                <li>
                  <a href="https://twitter.com/fluid_dex" target="_blank" rel="noopener noreferrer" >Twitter</a>
                </li>
              
                

                
                  
                

                <li>
                  <a href="https://t.me/fluid_dex" target="_blank" rel="noopener noreferrer" >Telegram</a>
                </li>
              
            

            

              
                

                
                  
                

                <li>
                  <a href="/feed.xml" target="_blank" rel="noopener noreferrer" >RSS</a>
                </li>
              
            
          </ul>

          
            <p class="footer__attribution">
      Powered by <a href="https://www.11ty.dev" target="_blank" rel="noopener">Eleventy</a>
        and <a href="https://github.com/yinkakun/eleventy-duo" target="_blank" rel="noopener noreferrer">Eleventy Duo</a>
            </p>
          

        </div>
      </div>

    </footer>

    <script src="/assets/main.31d6cfe0d16ae931b73c.js"></script>
  </body>
</html>
